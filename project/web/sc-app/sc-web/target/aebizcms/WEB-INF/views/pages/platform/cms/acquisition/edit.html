<!--#
layout("/layouts/platform.html"){
#-->
<style type="text/css">
    span{
        margin-top:7px;
    };
</style>
<header class="header navbar bg-white shadow">
    <div class="btn-group tool-button">
        <a class="btn btn-primary navbar-btn" href="${base}/platform/cms/acquisition" id="goBack" data-pjax><i class="ti-angle-left"></i>${msg['globals.button.back']}</a>
    </div>
</header>

<div class="content-wrap">
    <div class="wrapper" style="min-height:500px;">
        <section class="panel panel-form">
            <form id="editForm" role="form" class="form-horizontal parsley-form" data-parsley-validate
                  action="${base}/platform/cms/acquisition/editDo" method="post">
                <input name="id" type="hidden" value="${obj.id}">
                <input type="hidden"  id="channelID" value="${obj.channel_id}" />
                <div class="row mb10 mt10">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label for="acq_name" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.acq_name']}<span style="color: red">*</span></label>
                            <div class="col-sm-2">
                            <input type="text" id="acq_name" data-parsley-maxlength="100" style="width:190px;" value="${obj.acq_name}" class="form-control" name="acq_name" data-parsley-required="true" placeholder="${msg['cms.acquisition.column.acq_name']}">
                            </div>
                            <label for="acq_name" class="col-sm-1 control-label">${msg['cms.acquisition.in']}</label>
                            <div class="col-sm-7" style="width: 750px">
                                <div style="width: 150px;float: left;">
                                    <span style="float: left;">${msg['cms.acquisition.column.model_id']}</span>
                                    <select name="model_id" id="typeID" class="form-control"  style="width: 100px;">
                                        <!--# for(o in cmsModelList){#-->
                                        <option value="${o.id}" <!--#if(o.id==obj.model_id){#-->selected<!--#}#-->>${o.model_name}</option>
                                        <!--#} #-->
                                        </select>
                                </div>
                                <div style="width: 200px;float: left;">
                                        <span style="float: left;">${msg['cms.acquisition.column.site_id']}</span>
                                        <select name="site_id" id="siteType" class="form-control"  style="width: 150px;">
                                            <!--# for(o in cmsSiteList){
                                            #-->
                                            <option value="${o.id}" <!--#if(o.id==obj.site_id){#-->selected<!--#}#-->>${o.site_sname}</option>
                                            <!--#
                                            } #-->
                                    </select>
                                </div>
                                <div style="width: 350px;float: left;">
                                    <span style="float: left;"> ${msg['cms.acquisition.column.channel_id']}</span>
                                    <div>
                                    <select name="channel_id" id="channelType" class="form-control"  style="width:200px;float: left;">
                                        <option value="0" class="sel-disabled"> ${msg['cms.acquisition.choose']}</option>
                                    </select>
                                    </div>
                                    <div><span style="float: left;">${msg['cms.acquisition.channel.notice']}</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="page_encoding" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.page_encoding']}<span style="color: red">*</span></label>
                            <div class="col-sm-3">
                                <input type="text" id="page_encoding" style="width:190px;float: left;" class="form-control" data-parsley-maxlength="10" name="page_encoding" data-parsley-required="true" value="${obj.page_encoding}" placeholder="${msg['cms.acquisition.column.page_encoding']}">
                                <span style="float: left;">${msg['cms.acquisition.encoding.notice']}</span>
                            </div>
                            <label for="pause_time" class="col-sm-1 control-label">${msg['cms.acquisition.column.pause_time']}<span style="color: red">*</span></label>
                            <div class="col-sm-7" style="width: 500px">
                                <input type="text" id="pause_time" style="width:80px;float: left;" data-parsley-type="integer"   value="${obj.pause_time}" class="form-control" name="pause_time" data-parsley-required="true">
                                <span style="float: left;">${msg['cms.acquisition.column.pause_time.notice']}</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="plan_list" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.plan_list']}</label>
                            <div class="col-sm-8">
                                <input type="text" id="plan_list" class="form-control" data-parsley-maxlength="220" name="plan_list" value="${obj.plan_list}" placeholder="${msg['cms.acquisition.column.plan_list']}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="dynamic_addr" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.dynamic_addr']}</label>
                            <div class="col-sm-8">
                                <input type="text" id="dynamic_addr" class="form-control" data-parsley-maxlength="220" name="dynamic_addr"  value="${obj.dynamic_addr}" style="width: 315px;float: left;" placeholder="${msg['cms.acquisition.column.dynamic_addr']}">
                                <span  style="float: left;">${msg['cms.acquisition.page.notice']}</span>
                                <span style="float: left;">&nbsp;&nbsp;&nbsp;&nbsp;${msg['cms.acquisition.page.number']}&nbsp;&nbsp; ${msg['cms.acquisition.page.start']}&nbsp;</span>
                                <input type="text" id="dynamic_start" value="${obj.dynamic_start}" data-parsley-type="integer" style="width: 50px;float: left;" class="form-control" name="dynamic_start" >
                                <span style="float: left;">&nbsp;&nbsp;${msg['cms.acquisition.page.end']}</span>
                                <input type="text" id="dynamic_end" value="${obj.dynamic_end}" data-parsley-type="integer" style="width: 50px" class="form-control" name="dynamic_end" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="content_prefix" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.content_prefix']}</label>
                            <div class="col-sm-8">
                                <input type="text" id="content_prefix" class="form-control" data-parsley-maxlength="220" value="${obj.content_prefix}" name="content_prefix" placeholder="${msg['cms.acquisition.column.content_prefix']}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="img_prefix" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.img_prefix']}</label>
                            <div class="col-sm-8">
                                <input type="text" id="img_prefix" class="form-control" data-parsley-maxlength="220" name="img_prefix" value="${obj.img_prefix}" placeholder="${msg['cms.acquisition.column.img_prefix']}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="img_prefix" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                ${msg['cms.acquisition.column.start']}
                            </div>
                            <label for="img_prefix" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                ${msg['cms.acquisition.column.end']}
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="linkset_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.linkset']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="linkset_start" data-parsley-maxlength="220" class="form-control" name="linkset_start">${obj.linkset_start}</textarea>
                            </div>
                            <label for="linkset_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="linkset_end" data-parsley-maxlength="220" class="form-control" name="linkset_end">${obj.linkset_end}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="link_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.link']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="link_start" data-parsley-maxlength="220" class="form-control" name="link_start">${obj.link_start}</textarea>
                            </div>
                            <label for="link_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="link_end" data-parsley-maxlength="220" class="form-control" name="link_end">${obj.link_end}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="title_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.title']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="title_start" data-parsley-maxlength="220" class="form-control" name="title_start">${obj.title_start}</textarea>
                            </div>
                            <label for="title_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="title_end" data-parsley-maxlength="220" class="form-control" name="title_end">${obj.title_end}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="content_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.content']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="content_start" data-parsley-maxlength="220" class="form-control" name="content_start">${obj.content_start}</textarea>
                            </div>
                            <label for="content_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="content_end" data-parsley-maxlength="220" class="form-control" name="content_end">${obj.content_end}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="author_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.author']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="author_start" data-parsley-maxlength="220" class="form-control" name="author_start">${obj.author_start}</textarea>
                            </div>
                            <label for="author_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="author_end" data-parsley-maxlength="220" class="form-control" name="author_end">${obj.author_end}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="origin_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.origin']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="origin_start" data-parsley-maxlength="220" class="form-control" name="origin_start">${obj.origin_start}</textarea>
                            </div>
                            <label for="origin_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="origin_end" data-parsley-maxlength="220" class="form-control" name="origin_end">${obj.origin_end}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="releasetime_start" style="width:120px;" class="col-sm-1 control-label">${msg['cms.acquisition.column.releasetime']}</label>
                            <div class="col-sm-4">
                                <textarea type="text" id="releasetime_start" data-parsley-maxlength="220" class="form-control" name="releasetime_start">${obj.releasetime_start}</textarea>
                            </div>
                            <label for="releasetime_end" style="width:120px;" class="col-sm-1 control-label"></label>
                            <div class="col-sm-4">
                                <textarea type="text" id="releasetime_end" data-parsley-maxlength="220" class="form-control" name="releasetime_end">${obj.releasetime_end}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3"></div>
                <div class="col-lg-6">
                    <div class="form-group text-center">
                        <label></label>

                        <div>
                            <button class="btn btn-primary btn-block btn-lg btn-parsley" data-loading-text="${msg['globals.button.submit.tip']}">${msg['globals.button.submit']}</button>
                        </div>
                    </div>
                </div>
            </form>
        </section>
    </div>
</div>
<script language="JavaScript">
    $(document).ready(function () {
        $("#siteType").ready(function(){
            var site_id = $("#siteType").val();
            jQuery.ajax({
                type: 'POST',
                url : "${base}/platform/cms/acquisition/getChannelSelected" ,
                data : {"site_id":site_id},
                success : function (res) {
                    var str="";
                    var selector=$("#channelType");
                    if(res!=""){
                        selector.empty();
                        selector.append("<option value=''>${msg['cms.acquisition.choose']}</option>");
                        jQuery.each(res, function(index, term) {
                            str=gettreecode(term.id)+term.name;
                            selector.append("<option value=\""+term.id+"\" >"+str+"</option>");
                        });
                        selector.val($("#channelID").val());
                    }else{
                        selector.append("<option value=''>${msg['cms.acquisition.choose']}</option>");
                    }
                    return false;
                },
                fail : function(res) {
                    Toast.error(res.msg);
                }
            });
        });

        $("#siteType").change(function(){
            var site_id = $("#siteType").val();
            jQuery.ajax({
                type: 'POST',
                url : "${base}/platform/cms/acquisition/getChannelSelected" ,
                data : {"site_id":site_id},
                success : function (res) {
                    console.log(res!="");
                    var selector=$("#channelType");
                    selector.empty();
                    if(res!=""){
                        var str="";
                        selector.append("<option value=''>${msg['cms.acquisition.choose']}</option>");
                        jQuery.each(res, function(index, term) {
                            str=gettreecode(term.id)+term.name;
                            selector.append("<option value=\""+term.id+"\" >"+str+"</option>");
                        });
                        selector.val($("#channelID").val());
                    }else{
                        selector.append("<option value=''>${msg['cms.acquisition.choose']}</option>");
                    }
                    return false;
                },
                fail : function(res) {
                    Toast.error(res.msg);
                }
            });
        });



        $('#editForm').ajaxForm({
            dataType: 'json',
            beforeSubmit: function (arr, form, options) {
                form.find("button:submit").button("loading");
            },
            success: function (data, statusText, xhr, form) {
                if (data.code == 0) {
                    Toast.success(data.msg);
                    setTimeout(function () {
                        $("#goBack").trigger("click");
                    }, 1000);
                } else {
                    Toast.error(data.msg);
                }
                form.find("button:submit").button("reset");
            }
        });
    });
    //得到下拉框的级别html代码方式
    function gettreecode(id)
    {

        var line="&nbsp;";
        var node="&nbsp;├";
        var restr="";
        var count= id.length / 4;
        for(var tmp=1;tmp<count;tmp++)
        {
            restr+=line;
        }
        return restr+=node;
    }
</script>
<!--#}#-->


